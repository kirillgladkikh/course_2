# === Работа с файлами ===
# Создан абстрактный класс для работы с файлами.
# Реализован метод получения данных из файла.
# Реализован метод ???получения??? добавления данных в файл.
# Реализован метод удаления данных из файла.
# Используется декоратор @abstract_method для методов абстрактного класса.
# Абстрактные методы не имеют реализации.
#
# Реализован класс для работы с JSON-файлами.
# Класс для работы с JSON-файлами наследуется от абстрактного.
# В JSON-файл сохраняются данные, соответствующие атрибутам класса вакансий, с данными в виде списка словарей.
# Файл не перезаписывается при каждом запуске программы, а добавляет данные.
# Файл не сохраняет дубли вакансий.
# В экземплярах класса есть атрибут — имя файла, которое может быть назначено при создании экземпляра.
# Атрибут имени файла — приватный.
# Атрибут имени файла имеет значение по умолчанию.
# Реализованы дополнительные классы для работы с файлами.
#
# +++
# Определить абстрактный класс, который обязывает реализовать методы для добавления вакансий в файл,
# получения данных из файла по указанным критериям и удаления информации о вакансиях.
# Создать класс для сохранения информации о вакансиях в JSON-файл.
# Дополнительно, по желанию, можно реализовать классы для работы с другими форматами,
# например с CSV- или Excel-файлом, с TXT-файлом.
# Данный класс выступит в роли основы для коннектора, заменяя который (класс-коннектор),
# можно использовать в качестве хранилища одну из баз данных или удаленное хранилище со своей специфической системой обращений.
# В случае если какие-то из методов выглядят не используемыми для работы с файлами, то не стоит их удалять.
# Они пригодятся для интеграции к БД. Сделайте заглушку в коде.










# Вариант ИИ
import json
import os
from typing import List
from file_base import FileSaver
from vacancy import Vacancy


class JSONSaver(FileSaver):
    """
    Класс для сохранения вакансий в JSON-файл.
    Реализует методы работы с JSON-файлом.
    """

    def __init__(self, filename: str = "vacancies.json"):
        """
        Инициализация савера с указанием имени файла.

        :param filename: имя JSON-файла для сохранения данных
        """
        self.filename = filename

    def save(self, vacancies: List[Vacancy]) -> None:
        """
        Сохраняет список вакансий в JSON-файл.

        :param vacancies: список объектов Vacancy для сохранения
        """
        # Преобразуем объекты Vacancy в словари для JSON
        data = [vacancy.to_dict() for vacancy in vacancies]

        with open(self.filename, "w", encoding="utf-8") as file:
            json.dump(data, file, ensure_ascii=False, indent=4)

    def load(self) -> List[Vacancy]:
        """
        Загружает список вакансий из JSON-файла.

        :return: список объектов Vacancy
        :raises FileNotFoundError: если файл не найден
        :raises json.JSONDecodeError: если файл содержит некорректный JSON
        """
        if not os.path.exists(self.filename):
            raise FileNotFoundError(f"Файл {self.filename} не найден.")

        with open(self.filename, "r", encoding="utf-8") as file:
            data = json.load(file)

        # Преобразуем словари обратно в объекты Vacancy
        return [Vacancy.from_dict(item) for item in data]

    def add(self, vacancy: Vacancy) -> None:
        """
        Добавляет одну вакансию в JSON-файл.

        :param vacancy: объект Vacancy для добавления
        """
        try:
            # Загружаем существующие вакансии
            vacancies = self.load()
        except (FileNotFoundError, json.JSONDecodeError):
            # Если файла нет или он пуст/некорректен — начинаем с пустого списка
            vacancies = []

        # Добавляем новую вакансию
        vacancies.append(vacancy)

        # Сохраняем обновлённый список
        self.save(vacancies)

    def clear(self) -> None:
        """
        Очищает файл (удаляет все данные).
        """
        with open(self.filename, "w", encoding="utf-8") as file:
            json.dump([], file, ensure_ascii=False, indent=4)
